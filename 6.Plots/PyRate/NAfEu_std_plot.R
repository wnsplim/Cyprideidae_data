library(scales)
library(ggplot2)
library(ggnewscale)

# NAfEu_std
time_sp=c(-111.683189495, -112.251220485,-112.81925147500002,-113.387282465,-113.95531345500001,-114.52334444499999,-115.091375435,-115.65940642500001,-116.227437415,-116.79546840500001,-117.36349939499999,-117.931530385,-118.49956137500001,-119.067592365,-119.635623355,-120.20365434499999,-120.771685335,-121.33971632500001,-121.907747315,-122.475778305,-123.04380929499999,-123.611840285,-124.17987127500001,-124.747902265,-125.315933255,-125.88396424499999,-126.451995235,-127.02002622500001,-127.58805721499999,-128.156088205,-128.724119195,-129.292150185,-129.86018117499998,-130.428212165,-130.996243155,-131.56427414499998,-132.132305135,-132.70033612499998,-133.268367115,-133.836398105,-134.40442909499998,-134.972460085,-135.54049107499998,-136.108522065,-136.676553055,-137.24458404499998,-137.812615035,-138.38064602499998,-138.948677015,-139.516708005,-140.08473899499998,-140.652769985,-141.220800975,-141.78883196499999,-142.356862955,-142.92489394499998,-143.492924935,-144.06095592499997,-144.62898691499998,-145.197017905,-145.765048895,-146.333079885,-146.901110875,-147.46914186499998,-148.037172855,-148.605203845,-149.173234835,-149.741265825,-150.30929681499998,-150.877327805,-151.445358795,-152.013389785,-152.581420775,-153.14945176499998,-153.717482755,-154.285513745,-154.85354473499999,-155.421575725,-155.98960671499998,-156.557637705,-157.125668695,-157.69369968499998,-158.261730675,-158.82976166499998,-159.397792655,-159.965823645,-160.53385463499998,-161.101885625,-161.66991661499998,-162.237947605,-162.805978595,-163.37400958499998,-163.942040575,-164.51007156499998,-165.078102555,-165.646133545,-166.21416453499998,-166.782195525,-167.35022651499997,-167.91825750499999)
rate_sp=c(0.1996962051065851, 0.1996542470262842,0.1996351395850829,0.1996466433395494,0.19965688376595792,0.19968218910464547,0.19969042951723223,0.19969538943934478,0.19969391458356456,0.19970924181794064,0.19973526238981912,0.1998078457981014,0.1998629066287891,0.19994213648172332,0.20008297431989913,0.20027759893823924,0.20053457650712136,0.2009581298191664,0.20150101344960586,0.20256889286179414,0.20491722030694706,0.20710472001704505,0.20745176400123963,0.20753666005546928,0.20751652999842227,0.2074960858742655,0.2075266129332639,0.20755494827611706,0.20763561413110804,0.20775340553259541,0.20797206873354554,0.2081347674307248,0.2083178052367527,0.20855044978819953,0.20875573523669103,0.20898721081469654,0.2092798268536818,0.20955544880484595,0.20962727851980673,0.20965914396761662,0.20978292478061283,0.21021299417941142,0.21317499399386103,0.22689581915625368,0.2300288478247805,0.23021872826299256,0.23035624890166032,0.2304954343054703,0.23089510107925593,0.2318662413538319,0.2328599850063732,0.23421236217946548,0.24658314848630702,0.5325388062172848,0.5631953310676256,0.5630497634860296,0.5625313257657655,0.5619612541734404,0.5606737920901923,0.5595576369218289,0.5580731399894663,0.556650845092784,0.5558900330636967,0.5548658465073643,0.5471241466936527,0.5386791616509995,0.5300034845102497,0.5206009079165594,0.5117977683288186,0.503742956670084,0.49752483352725413,0.491946390359895,0.48792067440576736,0.4855272993782838,0.48339194784854905,0.4819783547884572,0.48119729037329717,0.4806193350952753,0.4802875824482734,0.48018637426961597,0.48048671256641695,0.48119636959969553,0.4820639547369825,0.4834997877485122,0.4856630833850368,0.48839026708339983,0.4929763469144002,0.49960130108413614,0.506325996830455,0.5105007462384124,0.5133228768522834,0.5155480035169082,0.5178779777859673,0.5199540387779115,0.5219039028751122,0.523904389705574,0.5259932235965403,0.5280735670590715,0.5302211678776041,0.5320016537852481)
minHPD_sp=c(0.045033046611109476, 0.048769270986025536,0.05080285215003125,0.05214626347085079,0.051772586497916495,0.0524572600058467,0.05107124553215612,0.051803405551227054,0.0524850315296699,0.05706813513292273,0.057338525447896464,0.055750035138314606,0.06394797714242403,0.06380130270260506,0.06417693705792746,0.06425522515161272,0.07028929230685489,0.07360890286223705,0.08368988238700739,0.09203934659247412,0.11073792545929369,0.12012309909906023,0.12165746919663331,0.1219216485812512,0.12204652285359029,0.12234838127880396,0.12235384095666024,0.12234838127880396,0.12215365849725736,0.12165746919663331,0.12194709805190247,0.12245474700511638,0.12193285925431034,0.12193285925431034,0.12339742886288509,0.12193285925431034,0.12221013893782358,0.12350286601909327,0.12092663983468518,0.11667706167974663,0.11941821956392443,0.12130772074309724,0.11665860531845756,0.14542234206537216,0.15028215062972342,0.15028215062972342,0.15174677380023044,0.15198236714943789,0.15035000119020347,0.15174677380023044,0.15059976304371828,0.15028215062972342,0.1484221655022127,0.1852181501737397,0.30134406143258724,0.301806815366932,0.3013833084792964,0.3018356567314396,0.3015737556642948,0.30139169930143356,0.2987265589643605,0.29424646602728555,0.29052356208857083,0.28631851465171454,0.25449333510541045,0.20593460272565906,0.13353183935728813,0.09384625246001156,0.08639209605601644,0.07198276420028756,0.0635622057246591,0.05576416015960752,0.05241577789709,0.04895110216654156,0.04262208472911809,0.04224552088411545,0.03824982056905417,0.037011410476270906,0.036898783640536906,0.03797791090207187,0.04145160292419131,0.03692392103650994,0.036898783640536906,0.03684557958368404,0.03691292094032538,0.031309835490009576,0.016473363545465494,0.003919404235281241,0.012296686497921188,0.020280321639934568,0.03068785119667897,0.03642021819025327,0.03729449033385475,0.03735678818733688,0.03414256036409237,0.035290779217222075,0.03414256036409237,0.03780748562817752,0.03780748562817752,0.040058052904775)
maxHPD_sp=c(0.2881836527283249, 0.2894894098664464,0.28978169860375386,0.28956698401797426,0.28768254002902593,0.28710403698467485,0.2846358682988667,0.2840739823198508,0.2834442127790574,0.28710403698467485,0.28664897833246844,0.28416020829948885,0.290780681853498,0.2894894098664464,0.2885484026682946,0.2872899077050477,0.29106150570358513,0.29106150570358513,0.2970676279373736,0.29753916313750517,0.29722908042639584,0.29742619128676573,0.29803949368324706,0.2977676265203983,0.2971101528376597,0.29707656515447495,0.29707248574093004,0.2971015569834332,0.29724217111034573,0.29781752424969077,0.300190872696547,0.3024295138912504,0.30369246315631726,0.3060505500022862,0.30987846725871593,0.31138559454254316,0.3163152414944255,0.3214684966979721,0.32246071176553714,0.3225645994562027,0.3302757863499875,0.3402930513466493,0.38693171225524425,0.4914237508662264,0.4996711244547684,0.4992291698881784,0.5000485022529455,0.5005139831669089,0.5000742879947593,0.5051105890074463,0.5086163886577281,0.5165805066576998,0.5839379919990445,0.816734213908025,0.856719151374084,0.8518117355997757,0.8484591606211549,0.8482016325639754,0.8482381463971134,0.8485603738305862,0.8489494985257957,0.8489706289776665,0.848924855625409,0.855814543012834,0.8711694863984846,0.8863152241125501,0.8485754460898854,0.818889939199984,0.8131381326681737,0.7989172305699539,0.7888162714122247,0.7783600154045832,0.7731501980384863,0.7690185992594704,0.7623225466778882,0.7621955689996947,0.7586517354848825,0.7583346330828175,0.7594823074906931,0.7621814550628105,0.7692230148141007,0.7696347555731516,0.7762725457959634,0.7851223217408632,0.7974020608065546,0.8104047695923184,0.8340007402702355,0.9302891802848526,1.1872802650517866,1.3725963665639325,1.4851771142075927,1.5751337233513247,1.6569581267536502,1.7152073956286842,1.7671739355614309,1.8264851745844064,1.8873684816823568,1.942075587036483,1.983033524905664,2.016421861459386)

mids_sp=c(-111.68605833838384, -112.25982701515153,-112.83359569191919,-113.40736436868687,-113.98113304545456,-114.55490172222224,-115.1286703989899,-115.70243907575758,-116.27620775252527,-116.84997642929292,-117.42374510606061,-117.99751378282829,-118.57128245959598,-119.14505113636363,-119.71881981313132,-120.292588489899,-120.86635716666666,-121.44012584343434,-122.01389452020203,-122.58766319696971,-123.16143187373737,-123.73520055050506,-124.30896922727274,-124.8827379040404,-125.45650658080808,-126.03027525757577,-126.60404393434342,-127.17781261111111,-127.75158128787879,-128.32534996464648,-128.89911864141416,-129.47288731818182,-130.0466559949495,-130.6204246717172,-131.19419334848484,-131.76796202525253,-132.34173070202021,-132.91549937878787,-133.48926805555556,-134.06303673232324,-134.63680540909093,-135.21057408585858,-135.78434276262627,-136.35811143939395,-136.93188011616164,-137.5056487929293,-138.07941746969698,-138.65318614646466,-139.22695482323232,-139.8007235,-140.3744921767677,-140.94826085353534,-141.52202953030303,-142.09579820707071,-142.6695668838384,-143.24333556060606,-143.81710423737374,-144.39087291414143,-144.9646415909091,-145.53841026767677,-146.11217894444445,-146.68594762121214,-147.2597162979798,-147.83348497474748,-148.40725365151516,-148.98102232828282,-149.5547910050505,-150.1285596818182,-150.70232835858585,-151.27609703535353,-151.84986571212121,-152.4236343888889,-152.99740306565658,-153.57117174242424,-154.14494041919193,-154.7187090959596,-155.29247777272727,-155.86624644949495,-156.44001512626264,-157.0137838030303,-157.58755247979798,-158.16132115656566,-158.73508983333332,-159.308858510101,-159.8826271868687,-160.45639586363637,-161.03016454040403,-161.60393321717171,-162.1777018939394,-162.75147057070708,-163.32523924747474,-163.89900792424243,-164.4727766010101,-165.04654527777777,-165.62031395454545,-166.19408263131314,-166.7678513080808,-167.34161998484848,-167.91538866161616)
counts_sp=c(0.00352, 0.00296,0.00282,0.00293,0.0026,0.00249,0.00261,0.00246,0.0023,0.00221,0.00225,0.00278,0.00248,0.00296,0.00359,0.00441,0.00632,0.00733,0.01555,0.02936,0.01981,0.00392,0.00204,0.00183,0.00165,0.00125,0.00146,0.00176,0.00253,0.00347,0.00325,0.00297,0.00358,0.00355,0.00436,0.00495,0.00388,0.00376,0.00414,0.00446,0.01166,0.08141,0.10375,0.00925,0.00424,0.00377,0.00424,0.0075,0.01267,0.01279,0.02883,0.35921,0.29808,0.02355,0.00432,0.00324,0.00465,0.00572,0.00512,0.00642,0.0051,0.00522,0.01974,0.02701,0.02684,0.02729,0.02691,0.02392,0.02045,0.01671,0.01359,0.00987,0.00791,0.00595,0.00509,0.00511,0.00455,0.00455,0.00499,0.00584,0.00613,0.00738,0.00867,0.01031,0.0153,0.01987,0.0205,0.01501,0.01157,0.00954,0.00966,0.00886,0.00834,0.00935,0.00909,0.00885,0.00851,0.00791,0.00567)

time_ex=c(-111.683189495, -112.251220485,-112.81925147500002,-113.387282465,-113.95531345500001,-114.52334444499999,-115.091375435,-115.65940642500001,-116.227437415,-116.79546840500001,-117.36349939499999,-117.931530385,-118.49956137500001,-119.067592365,-119.635623355,-120.20365434499999,-120.771685335,-121.33971632500001,-121.907747315,-122.475778305,-123.04380929499999,-123.611840285,-124.17987127500001,-124.747902265,-125.315933255,-125.88396424499999,-126.451995235,-127.02002622500001,-127.58805721499999,-128.156088205,-128.724119195,-129.292150185,-129.86018117499998,-130.428212165,-130.996243155,-131.56427414499998,-132.132305135,-132.70033612499998,-133.268367115,-133.836398105,-134.40442909499998,-134.972460085,-135.54049107499998,-136.108522065,-136.676553055,-137.24458404499998,-137.812615035,-138.38064602499998,-138.948677015,-139.516708005,-140.08473899499998,-140.652769985,-141.220800975,-141.78883196499999,-142.356862955,-142.92489394499998,-143.492924935,-144.06095592499997,-144.62898691499998,-145.197017905,-145.765048895,-146.333079885,-146.901110875,-147.46914186499998,-148.037172855,-148.605203845,-149.173234835,-149.741265825,-150.30929681499998,-150.877327805,-151.445358795,-152.013389785,-152.581420775,-153.14945176499998,-153.717482755,-154.285513745,-154.85354473499999,-155.421575725,-155.98960671499998,-156.557637705,-157.125668695,-157.69369968499998,-158.261730675,-158.82976166499998,-159.397792655,-159.965823645,-160.53385463499998,-161.101885625,-161.66991661499998,-162.237947605,-162.805978595,-163.37400958499998,-163.942040575,-164.51007156499998,-165.078102555,-165.646133545,-166.21416453499998,-166.782195525,-167.35022651499997,-167.91825750499999)
rate_ex=c(0.29637222908239397, 0.29590649067373875,0.29564663759006277,0.29540813261031706,0.29523115436103486,0.2950525514672734,0.2948962737277891,0.29475469948636435,0.29455567311080977,0.2943565009471002,0.294023970176033,0.29348817995737886,0.2928111052763932,0.2922466307520648,0.29179958505689896,0.29140820247256766,0.2910505715016203,0.29048632332038427,0.2877210007473897,0.2828641218089946,0.28074290084277287,0.2794872404243153,0.27856455024685645,0.2780998375892878,0.2778696771088644,0.27764454938363947,0.2766120838463578,0.2757347839697585,0.2751783937749474,0.27458054189027725,0.27439149882253555,0.27442871939364416,0.2746275993803873,0.27522144143308935,0.27626231321993583,0.2786438936889244,0.2835284060002683,0.2915728704348789,0.2963282006240434,0.2983538292360913,0.29938056568437943,0.29860440281643985,0.2967938280011744,0.296801357511544,0.29700976549793656,0.2976389374950251,0.298908361999274,0.30010520547082786,0.3009357367168008,0.301455208596069,0.30164586795432247,0.30175481699237294,0.3017235976318387,0.30164915660760794,0.3015702360118737,0.30114758341773873,0.29614151493957047,0.2948958810462414,0.29429318825948036,0.2939431472523545,0.29371279173538145,0.2935668736068222,0.2934602703177984,0.2934528520608633,0.29348422766632953,0.29348199943788345,0.2934839792613172,0.2934574980761814,0.29324609282355246,0.29287313865979814,0.2924819720027876,0.2920682051404202,0.29161089583311195,0.291148003904722,0.29078393098162014,0.2904874920605468,0.29019914868598384,0.289988096867659,0.2898337701209731,0.28973901188633333,0.2897128151569901,0.28970528025132414,0.28977884130647313,0.2899252156995769,0.2901626402873175,0.2904544835015004,0.29090019903582076,0.29147579394068013,0.29218457808958687,0.29312233184738934,0.2941870796673034,0.29524521352346567,0.29637029840247897,0.29760347705178336,0.29877876312447926,0.3001152399665762,0.3014389707538221,0.30270850223374873,0.30421937375587815,0.30571703978475984)
minHPD_ex=c(0.1567006308590173, 0.1567006308590173,0.1566180851201313,0.15675972230396293,0.1567006308590173,0.1593436915233077,0.15973634583841487,0.1586097898989353,0.15976953665032104,0.15976953665032104,0.15867478573884852,0.1586097898989353,0.15545178100434195,0.1582422363814202,0.15524265427186704,0.15619545731303322,0.15619545731303322,0.1474609995723519,0.10436264914160207,0.08767234987583841,0.09075930005688615,0.09580366942875107,0.08792167477012745,0.08792167477012745,0.08768661541280816,0.08731089517175221,0.08083270957819877,0.07406001365978182,0.06844499961140145,0.06109358257177362,0.05612639259528919,0.05502038821889385,0.05463159871439109,0.05499315675608259,0.054359186512787275,0.05424116225634958,0.06134231088843428,0.08973556780780562,0.15702615117648575,0.18821210255877469,0.19390236032410504,0.20498758195404967,0.21008737207412553,0.210591522633665,0.21207293574066205,0.21197055640493337,0.21218042154186248,0.21707689920062012,0.21708103920626945,0.21904212092813338,0.21721072466994845,0.21817705034621337,0.217097716600922,0.21823956114264154,0.21730837997987426,0.21715046218566308,0.1560895087394123,0.11112357566229436,0.11034874267543952,0.10822236158608617,0.1069929337842141,0.10675398557114756,0.10614757194697745,0.105743520106328,0.10083004942014173,0.09914717013129007,0.09906574905074075,0.09924419826594234,0.08812651378828025,0.0863067399331048,0.08298605618386698,0.07995664559475003,0.07715659488657416,0.07686273046057879,0.07122569035771315,0.06635559671221693,0.06431691122752277,0.06444819369583682,0.06053244436870162,0.06013831158211638,0.05770275560225478,0.05450061332361715,0.050266815640808114,0.04658490782117943,0.03921338955963773,0.039223188159930394,0.03383066755543879,0.019301312341557526,0.00222141660059114,0.0002828740010240313,0.0003657659127939501,0.0002828740010240313,0.00011498332246861807,0.0002828740010240313,0.0002828740010240313,0.0002828740010240313,0.00353117208346299,0.004544978283812127,0.005426520526233336,0.004868616958513742)
maxHPD_ex=c(0.6679043543982025, 0.6462917204096263,0.6311921713731311,0.6205410117645556,0.611589301304915,0.6064892363044595,0.600487739856342,0.5953853918679495,0.5909428374655751,0.5864214785937837,0.577672599407847,0.568407746520186,0.5526959297530647,0.546718048741769,0.5394589398573852,0.5370448604614428,0.537165794075951,0.5284550253726344,0.47302722117904594,0.3838163024933809,0.37049528216844435,0.3704272905860327,0.36075026935155907,0.3604957671267026,0.36068996523229185,0.3608764492264598,0.3607567371809717,0.36059050857644986,0.3607567371809717,0.36100658483776765,0.3606526711873757,0.3609629155475491,0.36171649100022324,0.36364271588418284,0.366348266349585,0.3740897495791278,0.3958400084855083,0.43576722868170836,0.473288903127905,0.48391174985482444,0.47632738656461826,0.458125506615033,0.43897985366388365,0.43848745331574607,0.43877110925816515,0.43614761551063297,0.4306644887559877,0.43351764657058717,0.43508419344469246,0.4387459270776057,0.4374466570004624,0.4386201038863736,0.43744003267979154,0.43872311676193454,0.43829130285899953,0.4414236143218413,0.4591534575825897,0.4279372475794135,0.4290179103975309,0.4282696729828575,0.4278768672030102,0.4282696729828575,0.4282696729828575,0.4290179103975309,0.42562719160125434,0.42537557049788594,0.4264839009806112,0.4281900967437574,0.4187952949445127,0.41901497906001617,0.4187934341996737,0.4189172099846817,0.4187303430025457,0.4211711420786334,0.4186865478486581,0.41669965001877424,0.4168678249302018,0.41871766517978215,0.41698529984622434,0.41871766517978215,0.41901497906001617,0.41901497906001617,0.4187289764791925,0.42084319791768077,0.4212284122201252,0.4318103176818069,0.4434279950190836,0.4522703898881617,0.4817015655466289,0.6300229045145279,0.8500052083272577,1.0602874660629242,1.241146570450794,1.4140391742806098,1.5504496440119653,1.6716216311574075,1.7890305255693433,1.8875723524030013,1.98612428924856,2.0669029855493504)

mids_ex=c(-111.68605833838384, -112.25982701515153,-112.83359569191919,-113.40736436868687,-113.98113304545456,-114.55490172222224,-115.1286703989899,-115.70243907575758,-116.27620775252527,-116.84997642929292,-117.42374510606061,-117.99751378282829,-118.57128245959598,-119.14505113636363,-119.71881981313132,-120.292588489899,-120.86635716666666,-121.44012584343434,-122.01389452020203,-122.58766319696971,-123.16143187373737,-123.73520055050506,-124.30896922727274,-124.8827379040404,-125.45650658080808,-126.03027525757577,-126.60404393434342,-127.17781261111111,-127.75158128787879,-128.32534996464648,-128.89911864141416,-129.47288731818182,-130.0466559949495,-130.6204246717172,-131.19419334848484,-131.76796202525253,-132.34173070202021,-132.91549937878787,-133.48926805555556,-134.06303673232324,-134.63680540909093,-135.21057408585858,-135.78434276262627,-136.35811143939395,-136.93188011616164,-137.5056487929293,-138.07941746969698,-138.65318614646466,-139.22695482323232,-139.8007235,-140.3744921767677,-140.94826085353534,-141.52202953030303,-142.09579820707071,-142.6695668838384,-143.24333556060606,-143.81710423737374,-144.39087291414143,-144.9646415909091,-145.53841026767677,-146.11217894444445,-146.68594762121214,-147.2597162979798,-147.83348497474748,-148.40725365151516,-148.98102232828282,-149.5547910050505,-150.1285596818182,-150.70232835858585,-151.27609703535353,-151.84986571212121,-152.4236343888889,-152.99740306565658,-153.57117174242424,-154.14494041919193,-154.7187090959596,-155.29247777272727,-155.86624644949495,-156.44001512626264,-157.0137838030303,-157.58755247979798,-158.16132115656566,-158.73508983333332,-159.308858510101,-159.8826271868687,-160.45639586363637,-161.03016454040403,-161.60393321717171,-162.1777018939394,-162.75147057070708,-163.32523924747474,-163.89900792424243,-164.4727766010101,-165.04654527777777,-165.62031395454545,-166.19408263131314,-166.7678513080808,-167.34161998484848,-167.91538866161616)
counts_ex=c(0.00828, 0.00631,0.00512,0.00524,0.00467,0.00489,0.00457,0.00462,0.00461,0.00565,0.0076,0.00891,0.00771,0.00588,0.0053,0.00609,0.00835,0.03649,0.04519,0.01941,0.01372,0.00967,0.00581,0.00392,0.00443,0.01653,0.01161,0.01045,0.00944,0.00511,0.00343,0.00409,0.00734,0.01407,0.03061,0.0606,0.07988,0.02929,0.01808,0.00782,0.0314,0.00831,0.00243,0.00469,0.01047,0.01511,0.01037,0.00892,0.00429,0.00243,0.00184,0.00197,0.00226,0.00219,0.0414,0.02413,0.00938,0.00625,0.00474,0.00331,0.00331,0.00281,0.00307,0.00362,0.00323,0.00371,0.00445,0.00548,0.0067,0.00723,0.00682,0.00666,0.0069,0.00609,0.00576,0.0048,0.00445,0.00433,0.00433,0.00426,0.00491,0.00576,0.0064,0.00769,0.00921,0.01037,0.01208,0.01428,0.0148,0.0153,0.01534,0.01573,0.01571,0.01608,0.01558,0.01592,0.01644,0.01568,0.0099)


df_freq_sp <- data.frame(Time = mids_sp, Frequency = counts_sp)
df_rate_sp <- data.frame(Time = time_sp,Rate = rate_sp,MinHPD = minHPD_sp,MaxHPD = maxHPD_sp)

df_freq_ex <- data.frame(Time = mids_ex, Frequency = counts_ex)
df_rate_ex<- data.frame(Time = time_ex,Rate = rate_ex,MinHPD = minHPD_ex,MaxHPD = maxHPD_ex)

rate_max_fixed <- max(max(maxHPD_sp),max(maxHPD_ex))
freq_max <- max(max(df_freq_sp$Frequency),max(df_freq_ex$Frequency))
scaling_factor <- rate_max_fixed / freq_max

df_freq_sp$Frequency_scaled <- df_freq_sp$Frequency * scaling_factor
df_freq_ex$Frequency_scaled <- df_freq_ex$Frequency * scaling_factor

bf2 = 0.03282882199853104 * scaling_factor
bf6 = 0.2005166131962391 * scaling_factor

intervals <- data.frame(
  xmin = c(-Inf, -168.2, -165.3, -161.5, -154.8, -149.2, -145, -139.8, -132.6, -125.77, -121.4, -113),
  xmax = c(-168.2, -165.3, -161.5, -154.8, -149.2, -145, -139.8, -132.6, -125.77, -121.4, -113, Inf),
  fill = rep(c("grey97", "white"), length.out = 12)
)


p <- ggplot() +
  geom_rect(data = intervals, aes(xmin = xmin, xmax = xmax, ymin = -Inf, ymax = Inf, fill = fill),
            inherit.aes = FALSE, alpha = 1) +
  scale_fill_identity() +
  geom_linerange(data = df_freq_ex, aes(x = Time, ymin = 0, ymax = Frequency_scaled),
                 color = '#E2968B', linewidth = 1.5) +
  geom_linerange(data = df_freq_sp, aes(x = Time, ymin = 0, ymax = Frequency_scaled),
                 color = '#a6a6e5', linewidth = 1.5) +
  geom_ribbon(data = df_rate_ex, aes(x = Time, ymin = MinHPD, ymax = MaxHPD),
                fill = alpha('red', 0.3), inherit.aes = FALSE) +
  geom_ribbon(data = df_rate_sp, aes(x = Time, ymin = MinHPD, ymax = MaxHPD),
              fill = alpha('blue', 0.3), inherit.aes = FALSE) +
  geom_line(data = df_rate_ex, aes(x = Time, y = Rate),
            color = 'red', linewidth = 1) +
  geom_line(data = df_rate_sp, aes(x = Time, y = Rate),
            color = 'blue', linewidth = 1) +
  geom_hline(yintercept = bf2, linetype = "dashed") +
  geom_hline(yintercept = bf6, linetype = "dashed") +
  
  scale_x_continuous(
    name = "Time (Mya)",
    limits = c(-170, -110),
    breaks = seq(-160, -120, by = 10),
    labels = function(x) abs(x),
    expand = expansion(mult = c(0.01, 0.01))
  ) +
  
  scale_y_continuous(
    name = "Rate",
    limits = c(0, rate_max_fixed),
    breaks = seq(0, rate_max_fixed, by = 0.5),
    sec.axis = sec_axis(
      trans = ~ . / scaling_factor,
      name = "Frequency",
      breaks = seq(0, 0.5, by = 0.1)
    )
  ) +
  
  theme_minimal() +
  theme(
    panel.grid = element_blank(),
    axis.ticks = element_line(),
    axis.title.y.right = element_text(margin = margin(l = 10)),
    axis.title.y.left = element_text(margin = margin(r = 10)),
    axis.line = element_line()
  )

print(p)

ggsave(
  filename = "NAfEu_std.tiff",
  plot = p,
  width = 2048,
  height = 720,
  dpi = 300,
  units = "px",
  device = "tiff",
  compression = "lzw"
)

