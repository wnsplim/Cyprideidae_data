library(scales)
library(ggplot2)
library(ggnewscale)

#NAfEu
time_NAfEu=c(-111.683189495, -112.251220485,-112.81925147500002,-113.387282465,-113.95531345500001,-114.52334444499999,-115.091375435,-115.65940642500001,-116.227437415,-116.79546840500001,-117.36349939499999,-117.931530385,-118.49956137500001,-119.067592365,-119.635623355,-120.20365434499999,-120.771685335,-121.33971632500001,-121.907747315,-122.475778305,-123.04380929499999,-123.611840285,-124.17987127500001,-124.747902265,-125.315933255,-125.88396424499999,-126.451995235,-127.02002622500001,-127.58805721499999,-128.156088205,-128.724119195,-129.292150185,-129.86018117499998,-130.428212165,-130.996243155,-131.56427414499998,-132.132305135,-132.70033612499998,-133.268367115,-133.836398105,-134.40442909499998,-134.972460085,-135.54049107499998,-136.108522065,-136.676553055,-137.24458404499998,-137.812615035,-138.38064602499998,-138.948677015,-139.516708005,-140.08473899499998,-140.652769985,-141.220800975,-141.78883196499999,-142.356862955,-142.92489394499998,-143.492924935,-144.06095592499997,-144.62898691499998,-145.197017905,-145.765048895,-146.333079885,-146.901110875,-147.46914186499998,-148.037172855,-148.605203845,-149.173234835,-149.741265825,-150.30929681499998,-150.877327805,-151.445358795,-152.013389785,-152.581420775,-153.14945176499998,-153.717482755,-154.285513745,-154.85354473499999,-155.421575725,-155.98960671499998,-156.557637705,-157.125668695,-157.69369968499998,-158.261730675,-158.82976166499998,-159.397792655,-159.965823645,-160.53385463499998,-161.101885625,-161.66991661499998,-162.237947605,-162.805978595,-163.37400958499998,-163.942040575,-164.51007156499998,-165.078102555,-165.646133545,-166.21416453499998,-166.782195525,-167.35022651499997,-167.91825750499999)
rate_NAfEu=c(-0.14402366052502683, -0.13913238297081584,-0.13666312130158426,-0.1348467447844208,-0.13347299210766858,-0.13226652640239606,-0.13126931622294144,-0.13061057170531326,-0.129916646187578,-0.12894568821697636,-0.12736821485316951,-0.1248515444530209,-0.12148528813971463,-0.11884827429299934,-0.11704350639507977,-0.11550936984647718,-0.1140265254601826,-0.11114763528642142,-0.09938469044168927,-0.07807097944805938,-0.06599839249215599,-0.05659624162411808,-0.05331543158072893,-0.051984939386417545,-0.051628929302408005,-0.051208085993486155,-0.04794838998804848,-0.04488758407439592,-0.04273781330724733,-0.04026521411143833,-0.03871377933164707,-0.038073540325127504,-0.03794054118318564,-0.03829904858727303,-0.03977732403282107,-0.04418637499766213,-0.056197035285955245,-0.0840596340028805,-0.10216126767627771,-0.11010477873197423,-0.1133455201024023,-0.10123319923057848,-0.07606443362474467,-0.0370040899434477,-0.02984362014535071,-0.03153624182714495,-0.03528546584522041,-0.0385080121274821,-0.03975689807441713,-0.03859161438942248,-0.0361326229772572,-0.031943000328633064,-0.0021446402445484333,0.21679725599375532,0.2585702719262264,0.2595837557627811,0.27478712859153265,0.2774163387110656,0.2771389355605752,0.2767852499601912,0.2755954676311323,0.27426574108403257,0.2740181029947276,0.27452415148835124,0.2620405505275031,0.24853498602657975,0.23445147534005548,0.22021124443301807,0.20836622615849335,0.19888108426562343,0.19181751767909466,0.18621512078034513,0.18264235575227059,0.18101320534208218,0.17986524219716993,0.17931052010354798,0.1793475312202981,0.17935076302845376,0.17980879151899568,0.18057970767601667,0.1817751945249332,0.18402763866768135,0.1858449370589312,0.18848523012802942,0.19189635361583968,0.1968418771182392,0.2061680813004808,0.22321662294281217,0.24057401246510937,0.2439212463306873,0.23846792067857156,0.22964336688433312,0.22242160204186961,0.21160010387319156,0.20132591180299256,0.19008182449214703,0.18035522436376683,0.16904758613893522,0.158377253164096,0.14657860481792492)
minHPD_NAfEu=c(-0.5051293412098025, -0.4805742673010171,-0.46262440246879466,-0.44960248817890647,-0.43724402116461275,-0.4354574364505003,-0.41955921872921986,-0.419130815231121,-0.41144061416646716,-0.40739769924603575,-0.4047747619498112,-0.38432908758398177,-0.37222218366579163,-0.35924722205134335,-0.3536686053755751,-0.3492106226438775,-0.34706621755674943,-0.3359406543914547,-0.30246449182031887,-0.24192005614407194,-0.20599813088739036,-0.18896970294731918,-0.18598824241309672,-0.18162882240246186,-0.1811559808828299,-0.18162882240246186,-0.180925092787583,-0.18125607706620137,-0.18157159323459995,-0.18083894895283253,-0.18166297653582406,-0.18043588964527427,-0.1815668150485472,-0.18157159323459995,-0.18099680775310503,-0.19126765020843364,-0.20721319855739723,-0.2517066485808574,-0.2750524467184504,-0.29117503313921916,-0.3069855031457954,-0.2820134641982828,-0.2585098700021923,-0.22277496213810755,-0.22126008561231567,-0.2231373050137037,-0.22416251026165135,-0.22822869380257144,-0.2324664161755226,-0.2360331760238146,-0.23253049805828052,-0.2325947781099738,-0.23833510383506332,-0.13847316124531195,-0.04015092636821321,-0.03583877730393453,-0.018857841900505434,-0.018794296376184794,-0.01875505633069846,-0.019608179337721743,-0.02279384418761965,-0.030375771341414337,-0.030327408945474088,-0.030375771341414337,-0.059596783756254657,-0.1050552894517518,-0.16519033868515623,-0.1872674059489308,-0.21376090807447512,-0.2179662314808696,-0.2267488336148234,-0.2266639868333129,-0.23687474519630952,-0.24112196916263107,-0.23586969452291107,-0.23687474519630952,-0.23810053199967085,-0.23907353836191936,-0.2415102438643828,-0.24121022336243253,-0.24121022336243253,-0.24968415647287362,-0.2503599062685789,-0.25295798472269304,-0.27290828176826376,-0.2983900718453278,-0.34164284788148785,-0.3759666931952616,-0.5627106831261928,-0.7872599442998386,-1.1244706223974728,-1.2515163930764817,-1.3704521208002296,-1.6161998035484282,-1.731686646750185,-1.7819355349650463,-1.8893053993108349,-1.9250376719609223,-2.107687354534267,-2.210735149605458)
maxHPD_NAfEu=c(0.08294245414348192, 0.0736168767508162,0.07211473158936993,0.07211473158936993,0.07211473158936993,0.06418275458549166,0.07138422932528077,0.06418275458549166,0.06433511234234796,0.06109894441684996,0.056287852506938074,0.06442654043260526,0.06193859577651689,0.06442654043260526,0.06458783199097146,0.06477230422297162,0.06447237881078771,0.07213742307435722,0.0883863195898122,0.11265328837270835,0.12263553638315088,0.12249841721716456,0.1231569287461798,0.12663015899136773,0.12693160761301828,0.12663015899136773,0.13390516964692648,0.14084510957467256,0.14597420151707324,0.15351553986987146,0.1568740002022705,0.1604693970838938,0.16084447567765944,0.162920199270682,0.16673906844979938,0.16349233315738354,0.16174464292990598,0.13648052585727788,0.11848495871927889,0.11809381501724503,0.11286724240236334,0.10494021860515917,0.1353343941700771,0.23037773095409983,0.23603749581872113,0.23303529771186876,0.23306375885544034,0.23289773552307835,0.23306375885544034,0.235792017602769,0.24492890187071498,0.25296754606278193,0.3181472352391171,0.5412824450816874,0.5737834446325256,0.5731834385148843,0.5810869182269922,0.5815603486261429,0.5833031035907501,0.5836207459762295,0.5833031035907501,0.5806967094655238,0.5843949274059665,0.5965462053787934,0.613496399842939,0.6148465957348239,0.5831595768851173,0.57223703576132,0.546224324627625,0.5382715349424864,0.52721372290666,0.5258285614438364,0.5145633076998735,0.5097139301553749,0.5145187103794044,0.5145633076998735,0.5144378324932372,0.5158894288499416,0.5161696587640124,0.519592483132366,0.5258057749505448,0.5262442619527334,0.5390114116034485,0.5560684549812072,0.5657081992605901,0.5988553526617699,0.7204850306312462,1.1727014668523503,1.5853172294466047,1.8285356443851735,1.8447381626627615,1.9977373905103093,2.116415701225341,2.066264652084322,2.122453645978695,2.23907202789195,2.283998420022461,2.384060975266673,2.3220375932608417,2.31463443681529)
#WAfSAm
time_WAfSAm=c(-97.23432351000001, -97.70982053,-98.18531755000001,-98.66081457,-99.13631159,-99.61180861,-100.08730563,-100.56280265000001,-101.03829967,-101.51379669,-101.98929371,-102.46479073,-102.94028775,-103.41578477,-103.89128179000001,-104.36677881,-104.84227583,-105.31777285,-105.79326987,-106.26876689000001,-106.74426391,-107.21976093,-107.69525795,-108.17075497,-108.64625199000001,-109.12174901,-109.59724603000001,-110.07274305,-110.54824007,-111.02373709,-111.49923411,-111.97473113,-112.45022815,-112.92572517,-113.40122219,-113.87671921,-114.35221623,-114.82771325,-115.30321027000001,-115.77870729,-116.25420431,-116.72970133,-117.20519835,-117.68069537000001,-118.15619239,-118.63168940999999,-119.10718643,-119.58268345,-120.05818047,-120.53367749,-121.00917451,-121.48467153,-121.96016855,-122.43566557,-122.91116259,-123.38665961,-123.86215663,-124.33765365000001,-124.81315067,-125.28864769,-125.76414471,-126.23964173,-126.71513875000001,-127.19063577,-127.66613278999999,-128.14162980999998,-128.61712683000002,-129.09262385,-129.56812086999997,-130.04361789,-130.51911490999998,-130.99461193000002,-131.47010895,-131.94560596999997,-132.42110299,-132.89660001,-133.37209703000002,-133.84759405,-134.32309106999998,-134.79858809,-135.27408511,-135.74958213000002,-136.22507915,-136.70057616999998,-137.17607319,-137.65157021,-138.12706723000002,-138.60256425,-139.07806126999998,-139.55355829,-140.02905531,-140.50455232999997,-140.98004935,-141.45554636999998,-141.93104339,-142.40654041,-142.88203742999997,-143.35753445,-143.83303146999998)
rate_WAfSAm=c(-0.016045774139907917, -0.009239655969765486,-0.011888173981437157,-0.01475155691199918,-0.01820096322136282,-0.021370683653067567,-0.02424765310876266,-0.027518004500631563,-0.031085157383897145,-0.03489578043171295,-0.03808615722656841,-0.04182734250000697,-0.04488401333618197,-0.04831833328667568,-0.05138280149593805,-0.054613558143525844,-0.057729716939694274,-0.061158506008366004,-0.0643413087875527,-0.06711235567364769,-0.0699973201251942,-0.0730706929280284,-0.07595069608407912,-0.07874781250582041,-0.08183543812498176,-0.0850218300546445,-0.08774112966337001,-0.09011476269363898,-0.09292974104985946,-0.09566313164700965,-0.09752098283319098,-0.09909828693812747,-0.10036883721899181,-0.10157133647483113,-0.10243056721463503,-0.10318039781045044,-0.10372938177096894,-0.10429145010537606,-0.1050891964586109,-0.10591434016442747,-0.10643177871189365,-0.10654848801898482,-0.10604740310701517,-0.10533273884610209,-0.10410177237624196,-0.1034363689418909,-0.10307771338673181,-0.10261235026282642,-0.1022856161662217,-0.10175388309993524,-0.10134252145014973,-0.09979009832428877,-0.10112892009999036,-0.10319825909323692,-0.10795400915391219,-0.1074872732219696,-0.10441493384040298,-0.09774375645325165,-0.08423501302905727,-0.0670540708510746,-0.054218093584358376,-0.044289733311049184,-0.03717792101623082,-0.03282192850039454,-0.030607188772633877,-0.02881577615414838,-0.027280427257185453,-0.025379789074613867,-0.023894763275522042,-0.02298871011855646,-0.022355591626760915,-0.02200203693547693,-0.02178175190855236,-0.021611382169466373,-0.021435353579867623,-0.021260093594865317,-0.021205084960958548,-0.02113115846415238,-0.02106639633984238,-0.02103888094319016,-0.021032440667417992,-0.020979570865809084,-0.020807233918446945,-0.02032832620534357,-0.0196037455083665,-0.01854128301862517,-0.017558442427302572,-0.01656055825615151,-0.015729274830562745,-0.015007786817944693,-0.014255894575366801,-0.01371062789239275,-0.012876852696411287,-0.011830183951790463,-0.010567766663755411,-0.009055128496995034,-0.006688647664253164,-0.001987892573972258,-0.001987892573972258)
minHPD_WAfSAm=c(-0.765128090518732, -0.7648044311193902,-0.7638766187398688,-0.7634904589634981,-0.7440801099144473,-0.7338013309425611,-0.7636820641560192,-0.7638766187398688,-0.7440342436409356,-0.7638766187398688,-0.7638766187398688,-0.7438073461339922,-0.7334919622127795,-0.7334919622127795,-0.7331242839521014,-0.7317237092180084,-0.7236809419100878,-0.7238334759853922,-0.6939395055472679,-0.6878437794727101,-0.6902419987260691,-0.6880516422783813,-0.6704958964580731,-0.6672745579069979,-0.6557858449959585,-0.6396436721167462,-0.6521244537680768,-0.6557858449959585,-0.6395230221798869,-0.6401268745155406,-0.6401268745155406,-0.627860307345647,-0.6087078666045225,-0.6062303430786873,-0.6062303430786873,-0.606421919046331,-0.6062190520139208,-0.6108462129230471,-0.6183314496542709,-0.6090928602695717,-0.6064752180563717,-0.6070828710813692,-0.6086999689305114,-0.6090442971861121,-0.6202434725569244,-0.6336977368482182,-0.6606721977497749,-0.6647908828362303,-0.6802033731215889,-0.7130686734410927,-0.7445610306908411,-0.744853451873894,-0.744853451873894,-0.7429361218191279,-0.7332950694576009,-0.6880377275737695,-0.6436364401587249,-0.5750797405374029,-0.518151522920626,-0.4455208490512056,-0.37835641837409373,-0.3200908059628745,-0.262686158610919,-0.23357000542851625,-0.21857681457252148,-0.20716302591341992,-0.19806681388647196,-0.1952488017216818,-0.19023666579670906,-0.19023666579670906,-0.18697074055805568,-0.18509006991861926,-0.18524408685115684,-0.1842074456143616,-0.18226261885827394,-0.18025413330357393,-0.17971334437693715,-0.17971334437693715,-0.1796939120153736,-0.18025413330357393,-0.17882755696205538,-0.17971334437693715,-0.17970169905926414,-0.17882755696205538,-0.17971334437693715,-0.1788205975190148,-0.17852318709953202,-0.17894288140799142,-0.1768319821298283,-0.17850194376327838,-0.17386560595423656,-0.1737693133967688,-0.17659832318831215,-0.17735747435070065,-0.18265789903704382,-0.18283111363419763,-0.19020696096041803,-0.19176577178509174,-0.19176577178509174)
maxHPD_WAfSAm=c(0.7248048536427817, 0.6556643022646578,0.6492890351673875,0.6404336336815091,0.6499751841012469,0.6475271597527821,0.5990338534942325,0.587003846232909,0.5907659953644971,0.5496695151201338,0.5364299785557136,0.5372230682995549,0.5296421100656445,0.5116832617581173,0.49428821345017676,0.4759032291856585,0.46452144514267624,0.44896461939365523,0.45840082334721427,0.44595642717100975,0.4251875413005192,0.4124961034803584,0.41322703677582556,0.3999224597226464,0.3926126501760305,0.39364230450457605,0.3660255666168133,0.34556309294390614,0.34364189385579713,0.3264869653207826,0.3069998834245648,0.303658080235625,0.30639589667725425,0.295738179956767,0.28632642704865824,0.2785243361484788,0.27085029227543594,0.2600259607852819,0.24540541272648048,0.2478785209235208,0.24554046154609976,0.24523369605276413,0.24540541272648048,0.25049773569734357,0.24548430719618586,0.24115813588750462,0.22854490506965625,0.2404727062119132,0.25253140789193773,0.253347640632994,0.257206304577658,0.28205947739810683,0.28021926312033674,0.26735125832792883,0.23477551170608835,0.24267531408485343,0.2046532528538349,0.1888662592072265,0.17792270757934203,0.17713036045942043,0.18270951310768563,0.17269133570440415,0.17222649267646895,0.16268802043931851,0.15719677842891466,0.15466078100784864,0.15443245333833533,0.14809375097283434,0.14702412064164921,0.14285341038879773,0.14328235066941614,0.1425393767249184,0.14052659508916177,0.14052659508916177,0.14164567797094008,0.1428975114458863,0.14232275454757068,0.14177441767587873,0.14148353889887239,0.1405617918028252,0.14170728953827572,0.1404657328989341,0.14064046600289992,0.14165394049876368,0.14065599124272732,0.14213849196881478,0.14331139233883539,0.1441510381359401,0.14777034270885953,0.14777034270885953,0.15464552600936687,0.15627823650324973,0.15623546144570727,0.15954640569463685,0.15954640569463685,0.16632317601011756,0.168379834501169,0.1826422272151597,0.1826422272151597)


df_rate_NAfEu <- data.frame(Time = time_NAfEu,Rate = rate_NAfEu,MinHPD = minHPD_NAfEu,MaxHPD = maxHPD_NAfEu)
df_rate_WAfSAm <- data.frame(Time = time_WAfSAm,Rate = rate_WAfSAm,MinHPD = minHPD_WAfSAm,MaxHPD = maxHPD_WAfSAm)

intervals <- data.frame(
  xmin = c(-Inf, -168.2, -165.3, -161.5, -154.8, -149.2, -145, -139.8, -132.6, -125.77, -121.4, -113, -100.5),
  xmax = c(-168.2, -165.3, -161.5, -154.8, -149.2, -145, -139.8, -132.6, -125.77, -121.4, -113, -100.5, Inf),
  fill = rep(c("grey97", "white"), length.out = 13)
)


p <- ggplot() +
  geom_rect(data = intervals, aes(xmin = xmin, xmax = xmax, ymin = -Inf, ymax = Inf, fill = fill),
            inherit.aes = FALSE, alpha = 1) +
  scale_fill_identity() +
  geom_ribbon(data = df_rate_NAfEu, aes(x = Time, ymin = MinHPD, ymax = MaxHPD),
              fill = alpha('purple', 0.3), inherit.aes = FALSE) +
  geom_ribbon(data = df_rate_WAfSAm, aes(x = Time, ymin = MinHPD, ymax = MaxHPD),
              fill = alpha('#1eb72a', 0.3), inherit.aes = FALSE) +
  geom_line(data = df_rate_NAfEu, aes(x = Time, y = Rate),
            color = 'purple', linewidth = 1) +
  geom_line(data = df_rate_WAfSAm, aes(x = Time, y = Rate),
            color = '#1eb72a', linewidth = 1) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  
  scale_x_continuous(
    name = "Time (Mya)",
    limits = c(-170, -95),
    breaks = seq(-160, -100, by = 10),
    labels = function(x) abs(x),
    expand = expansion(mult = c(0.01, 0.01))
  ) +
  
  scale_y_continuous(
    name = "Rate",
    breaks = seq(-1.5, 1, by = 0.5),
  ) +
  
  coord_cartesian(ylim = c(-1.5, 1)) +
  
  theme_minimal() +
  theme(
    panel.grid = element_blank(),
    axis.ticks = element_line(),
    axis.title.y.right = element_text(margin = margin(l = 10)),
    axis.title.y.left = element_text(margin = margin(r = 10)),
    axis.line = element_line()
  )

print(p)

ggsave(
  filename = "Divrate_std.tiff",
  plot = p,
  width = 2048,
  height = 960,
  dpi = 300,
  units = "px",
  device = "tiff",
  compression = "lzw"
)

